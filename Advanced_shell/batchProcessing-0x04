#!/bin/bash
# Script: batchProcessing-0x04
# Objective: Fetch multiple Pokémon data in parallel using background processes
# Ensures proper process management with wait and kill

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
OUTPUT_DIR="pokemon_data"

# Create output directory if it doesn't exist
mkdir -p "$OUTPUT_DIR"

# Array to store process IDs
pids=()

# Loop through each Pokémon and fetch data in parallel
for pokemon in "${POKEMONS[@]}"; do
    echo "Fetching data for $pokemon..."
    curl -s "https://pokeapi.co/api/v2/pokemon/$pokemon" -o "$OUTPUT_DIR/$pokemon.json" && \
    echo "Saved data to $OUTPUT_DIR/$pokemon.json ✅" &
    pids+=($!)   # store PID of background process
done

# Wait for all background jobs to finish
for pid in "${pids[@]}"; do
    if ! wait $pid; then
        echo "⚠️ Process $pid failed, killing..."
        kill $pid 2>/dev/null
    fi
done

echo "All Pokémon data fetched successfully!"
